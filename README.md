
# Mongol - Хятадад зориулсан Супер Апп (Баримт Бичиг)

Энэхүү баримт бичиг нь "Mongol" аппликейшнийн технологийн стек, архитектур, үндсэн функц, файлын бүтэц, код хоорондын хамаарлыг дэлгэрэнгүй тайлбарлана. Энэ нь төслийн ирээдүйн хөгжүүлэлт, засвар үйлчилгээнд зориулсан үндсэн гарын авлага болно.

---

## Агуулга
1.  [Технологийн Стек](#технологийн-стек-technology-stack)
2.  [Үндсэн Функцууд](#үндсэн-функцууд-core-features)
3.  [Төслийг Ажиллуулах](#төслийг-ажиллуулах-getting-started)
4.  [Төслийн Бүтэц](#төслийн-бүтэц-project-structure)
5.  [src/ Директорийн гүнзгийрүүлсэн тайлбар](#src-директорийн-гүнзгийрүүлсэн-тайлбар)
    -    [`src/app/` - Хуудас ба Замчлал](#srcapp---хуудас-ба-замчлал-routing)
    -    [`src/components/` - Дахин Ашиглагдах Компонентууд](#srccomponents---дахин-ашиглагдах-компонентууд)
    -    [`src/contexts/` - Төлөв Удирдах Context](#srccontexts---төлөв-удирдах-context-global-state)
    -    [`src/hooks/` - Custom Hooks](#srchooks---custom-hooks)
    -    [`src/lib/` - Туслах функц ба Тохиргоо](#srclib---туслах-функц-ба-тохиргоо)
    -    [`src/types/` - TypeScript Төрлүүд](#srctypes---typescript-төрлүүд)
6.  [Мобайл Хувилбар (Capacitor)](#мобайл-хувилбар-capacitor)
    -    [Үндсэн тохиргоо](#үндсэн-тохиргоо)
    -    [Мобайл хувилбар үүсгэх заавар](#мобайл-хувилбар-үүсгэх-заавар)
    -    [Firebase & Push Notification тохиргоо](#firebase--push-notification-тохиргоо-мобайл-дээр)
7.  [Firebase & Аюулгүй Байдал](#firebase--аюулгүй-байдал)
    -    [`firestore.rules`](#firestorerules)
8.  [Төслийн бусад файлууд](#төслийн-бусад-файлууд)

---

## Технологийн Стек (Technology Stack)

Энэхүү төсөл нь орчин үеийн, найдвартай ажиллагаатай, хурдан технологиуд дээр суурилсан.

-   **Framework**: **Next.js 15 (App Router)** - Сервер талын рендер (SSR), статик хуудас үүсгэх (SSG), сайжруулсан замчлал зэрэг функцуудыг ашиглан хурдан, SEO-д ээлтэй вэб апп үүсгэхэд ашигласан. App Router нь nested layouts болон route groups үүсгэх боломжийг олгодог.
-   **Хэл**: **TypeScript** - Кодын чанар, уншигдах байдлыг сайжруулж, хөгжүүлэлтийн явцад гарах алдааг эрт илрүүлэх зорилготой.
-   **UI**:
    -   **React** - Хэрэглэгчийн интерфейсийг компонент-суурьтайгаар хөгжүүлэх үндсэн сан.
    -   **ShadCN UI** - Дахин ашиглагдах, өөрчлөхөд хялбар UI компонентуудыг (Button, Card, Input г.м) төсөлд шууд хуулж ашигладаг. Энэ нь кодын бүрэн хяналтыг хөгжүүлэгчид олгодог.
    -   **Tailwind CSS** - Утилити-ангилалд суурилсан CSS фреймворк. Хурдан, цэгцтэй загварчлал хийх боломжийг олгодог.
-   **Backend (BaaS)**: **Firebase** - Сервер талын цогц үйлчилгээг ашигладаг:
    -   **Authentication**: Хэрэглэгчийн бүртгэл, нэвтрэлтийг удирдах.
    -   **Firestore**: NoSQL өгөгдлийн сан. Аппын бүх динамик мэдээллийг хадгална.
    -   **Storage**: Зураг, файл байршуулах, удирдах үүлэн үйлчилгээ.
    -   **Cloud Messaging (FCM)**: Вэб болон мобайл апп руу push notification илгээх.
-   **Form Management**:
    -   **React Hook Form**: Формын төлөв, баталгаажуулалтыг үр ашигтай удирдах.
    -   **Zod**: Формын өгөгдлийн схемийг тодорхойлж, баталгаажуулалтын дүрмийг хялбархан үүсгэхэд ашигладаг.
-   **Мобайл Хөрвүүлэлт**: **Capacitor** - Одоо байгаа Next.js-ийн вэб кодыг ашиглан Native Android болон iOS апп болгон хөрвүүлэх боломжийг олгодог.
-   **AI**: **Genkit (Төлөвлөгдсөн)** - Google-ийн Gemini зэрэг хиймэл оюуны загваруудыг апп-д нэгтгэх, ухаалаг функцүүдийг хөгжүүлэхэд зориулагдсан.

---

## Үндсэн Функцууд (Core Features)

-   **Үйлчилгээ хайх**: Нислэг, буудал, орчуулагч, зах зээл гэх мэт олон төрлийн үйлчилгээг хотоор болон түлхүүр үгээр хайх, шүүх.
-   **Хэрэглэгчийн систем**: И-мэйлээр бүртгүүлэх, нэвтрэх, нууц үг сэргээх, хувийн мэдээллээ удирдах, профайл зураг солих.
-   **Захиалга**: Үйлчилгээг апп дотроос захиалах, захиалгын түүхээ харах, устгах.
-   **Хадгалах**: Сонирхсон үйлчилгээ, барааг "Хадгалсан" хэсэгт нэмэх, устгах.
-   **Мэдэгдэл**: Firebase Cloud Messaging-д суурилсан push notification систем (вэб болон мобайл).
-   **Олон хэл**: Монгол (mn) болон Хятад (cn) хэлний сонголт. Хэрэглэгчийн сонголтыг хадгална.
-   **Зургийн менежмент**: Firebase Storage ашиглан зураг байршуулах, Vercel Image Optimization ашиглан хурдасгах.
-   **Хувилбарын удирдлага**: Шинэ хувилбар гарсан үед хэрэглэгчид автоматаар мэдэгдэж, шинэчлэхийг санал болгох (эсвэл албадах) систем.

---

## Төслийг Ажиллуулах (Getting Started)

1.  **Repository-г хуулж авах:**
    ```bash
    git clone <repository_url>
    cd mongol-app
    ```
2.  **Dependencies суулгах:**
    ```bash
    npm install
    ```
3.  **Хөгжүүлэлтийн серверыг ажиллуулах:**
    ```bash
    npm run dev
    ```
4.  Хөтөч дээрээ [http://localhost:9002](http://localhost:9002) хаягаар орж апп-ыг харна уу.


---


## Төслийн Бүтэц (Project Structure)

Энэхүү төсөл нь Next.js App Router-ийн зарчимд суурилсан бөгөөд файлын бүтэц нь дараах байдалтай байна.

```
mongol-app/
├── src/
│   ├── app/
│   │   ├── (auth)/             # Нэвтрэлт, бүртгэлийн хуудсууд (тусдаа layout-тай)
│   │   │   ├── login/
│   │   │   └── register/
│   │   ├── main/               # НЭВТЭРСЭН хэрэглэгчийн хуудсууд (хамгаалалттай)
│   │   │   ├── layout.tsx      # Хамгаалалттай хэсгийн үндсэн layout, хамгаалалтын логик
│   │   │   ├── orders/
│   │   │   ├── notifications/
│   │   │   ├── profile/
│   │   │   └── saved/
│   │   ├── services/           # НИЙТИЙН үйлчилгээний хуудсууд (хамгаалалтгүй)
│   │   │   ├── layout.tsx      # Нийтийн хэсгийн үндсэн layout
│   │   │   ├── page.tsx        # Үндсэн нүүр хуудас
│   │   │   └── [category]/
│   │   │       └── [id]/
│   │   ├── globals.css         # Ерөнхий загвар, өнгөний тохиргоо
│   │   └── layout.tsx          # Root layout (хамгийн дээд түвшний)
│   │
│   ├── components/
│   │   ├── (ui)/               # ShadCN UI компонентууд
│   │   ├── auth/               # Нэвтрэлттэй холбоотой компонентууд
│   │   ├── layout/             # Header, BottomNav г.м
│   │   ├── profile/
│   │   └── services/
│   │
│   ├── contexts/               # Апп даяарх төлөв удирдах (Global State)
│   │   ├── AuthContext.tsx
│   │   ├── CityContext.tsx
│   │   ├── LanguageContext.tsx
│   │   └── SearchContext.tsx
│   │
│   ├── hooks/                  # Дахин ашиглагдах custom hook-ууд
│   │   ├── use-toast.ts
│   │   └── useTranslation.ts
│   │
│   ├── lib/                    # Туслах функц, тохиргоо
│   │   ├── firebase.ts         # Firebase-ийн үндсэн тохиргоо
│   │   ├── constants.ts
│   │   └── storageService.ts
│   │
│   └── types/                  # TypeScript-ийн төрлүүд
│       └── index.ts
│
├── public/                     # Зураг, фонт зэрэг статик файлууд
├── capacitor.config.ts         # Capacitor-ийн тохиргооны файл
├── next.config.ts              # Next.js-ийн тохиргооны файл
├── package.json
└── README.md
```

---

## `src/` Директорийн гүнзгийрүүлсэн тайлбар

Энэ бол төслийн үндсэн код байрлах гол хавтас юм. Доторх хавтас бүр тодорхой үүрэгтэй.

### `src/app/` - Хуудас ба Замчлал (Routing)

Энэ хавтас нь Next.js App Router-ийн зарчмын дагуу аппын бүх хуудас, замчлалыг тодорхойлно. Хавтасны нэр нь URL-ийн зам болдог.

#### **Гол файлууд:**
-   **`layout.tsx` (Root Layout)**: Бүх хуудсыг бүрхэж, аппын үндсэн суурийг тавьдаг хамгийн чухал файл.
    -   **Үүрэг:** HTML-ийн үндсэн тааг (`<html>`, `<body>`), фонтын тохиргоо, апп даяар ашиглагдах `AuthProvider`, `LanguageProvider` зэрэг глобал context-үүдийг агуулна. Мөн Vercel-ийн `Analytics`, `SpeedInsights`, `Toaster` (мэдэгдэл), `VersionCheck` зэрэг апп даяарх компонентуудыг энд тодорхойлно.
    ```tsx
    // src/app/layout.tsx
    export default function RootLayout({ children }: { children: React.ReactNode; }) {
      return (
        <html lang="en">
          <body>
            <AuthProvider>
              <LanguageProvider>
                {children}
                <Toaster />
                <VersionCheck />
              </LanguageProvider>
            </AuthProvider>
            <Analytics />
            <SpeedInsights />
          </body>
        </html>
      );
    }
    ```

-   **`globals.css`**: Аппын ерөнхий загвар. Tailwind CSS-ийн үндсэн layer-ууд болон ShadCN UI-ийн өнгөний тохиргоог (CSS variables) агуулдаг.

-   **`page.tsx`**: Аппын үндсэн нэвтрэх цэг (`/`). Хэрэглэгчийг шууд `/services` хуудас руу шилжүүлдэг (redirect).

#### **Замчлалын Группүүд:**

-   **`/(auth)/`**: Нэвтрэх, бүртгүүлэх зэрэг хэрэглэгчийн баталгаажуулалттай холбоотой хуудсуудын групп. Хаалттай хавтас `()` нь URL-д нөлөөлөхгүй, зөвхөн зохион байгуулалтын зорилготой.
    -   `layout.tsx`: Энэ группийн хуудсуудад зориулсан тусдаа загвар. Логотой, голлуулсан байрлалтай layout.
    -   `login/page.tsx`: `/auth/login` замд харгалзах хуудас. `LoginForm` компонентийг харуулна.
    -   `register/page.tsx`: `/auth/register` замд харгалзах хуудас. `RegisterForm` компонентийг харуулна.

-   **`/main/`**: **Зөвхөн нэвтэрсэн хэрэглэгчийн** хандах боломжтой хуудсуудын групп.
    -   `layout.tsx`: Энэ группт хандах бүх хуудасны үндсэн layout. Хэрэглэгч нэвтрээгүй бол `/auth/login` руу шилжүүлэх **хамгаалалтын логик** энд байрлана. Мөн нэвтэрсэн хэрэглэгчийн `Header`, `BottomNav`-ыг агуулна.
    -   `/main/orders/`, `/main/saved/`, `/main/notifications/`, `/main/profile/`: Захиалга, хадгалсан зүйлс, мэдэгдэл, хувийн мэдээлэл зэрэг хуудсуудыг агуулна.

-   **`/services/`**: **Нийтийн** буюу хэн ч хандах боломжтой үйлчилгээний хуудсууд.
    -   `layout.tsx`: Үйлчилгээний хуудсуудын үндсэн layout. Бүх хэрэглэгчид харагдах `Header`, `BottomNav`-ыг агуулж, `CityProvider`, `SearchProvider`-аар хуудсуудыг бүрхэнэ.
    -   `page.tsx`: Аппын нүүр хуудас (`/services`). Бүх үйлчилгээний ангиллын мэдээллийг серверээс татаж, карусель хэлбэрээр харуулна.
    -   `[category]/page.tsx`: Тухайн ангиллын (жишээ нь, `hotels`, `translators`) бүх үйлчилгээний жагсаалтыг харуулдаг динамик хуудас.
    -   `[category]/[id]/page.tsx`: Тухайн үйлчилгээний дэлгэрэнгүй мэдээллийг харуулдаг динамик хуудас.

### `src/components/` - Дахин Ашиглагдах Компонентууд

Энд апп-ын өөр өөр хуудсуудад дахин ашиглагдах боломжтой бүх UI компонентууд байрлана.

-   **/ui/**: `ShadCN UI`-аас үүсгэсэн үндсэн компонентууд (Button, Card, Input г.м). Эдгээр нь өөрчлөхөд нээлттэй, төслийн нэг хэсэг болдог.
-   **/auth/**: Нэвтрэлт, бүртгэл, нууц үг солих, хуудас хамгаалахтай холбоотой компонентууд (`LoginForm`, `RegisterForm`, `ProtectedPage`).
-   **/layout/**: Хуудасны ерөнхий бүтцийг бүрдүүлдэг компонентууд (`Header`, `BottomNav`).
-   **/services/**: Үйлчилгээтэй холбоотой компонентууд (`FlightSearchForm`, `TranslatorCard`, `ServiceCard` гэх мэт).
-   **/profile/**: Хэрэглэгчийн хувийн мэдээллийн форм (`PersonalInfoForm`) гэх мэт компонентууд.
-   **`AppInit.tsx`**: Апп эхлэх үед Firebase Cloud Messaging-ийн тохиргоог хийж, push notification-ыг хүлээж авах listener-ийг эхлүүлдэг компонент.
-   **`CitySelector.tsx`**: Хот сонгох функц бүхий компонент. `Header` дотор ашиглагддаг.
-   **`VersionCheck.tsx`**: Апп-ын хувилбарыг Firestore-той харьцуулж, шинэчлэлт гарсан бол хэрэглэгчид мэдэгдэх цонхыг харуулдаг компонент.

### `src/contexts/` - Төлөв Удирдах Context (Global State)

Апп-ын өөр өөр хэсгүүдэд төлөв (state)-ийг дамжуулах, удирдах зорилготой React Context-үүдийг агуулна.

-   **`AuthContext.tsx`**: Хэрэглэгчийн нэвтрэлтийн төлөв (`user`, `loading`), хадгалсан зүйлсийн ID (`savedItemIds`), болон холбогдох функцуудыг (`login`, `register`, `logout`, `addFavorite`) апп даяар дамжуулна. `useAuth` hook-оор дамжуулан ашиглана.
    -   **Гол Логик:** `onAuthStateChanged` listener ашиглан хэрэглэгчийн нэвтрэлтийн төлвийг бодит цагт хянаж, `user` state-ийг шинэчилдэг. Энэ нь апп-ыг аюулгүй, найдвартай болгодог.
    ```tsx
    // src/contexts/AuthContext.tsx
    useEffect(() => {
      const unsubscribeAuth = onAuthStateChanged(auth, async (firebaseUser) => {
        if (firebaseUser && firebaseUser.emailVerified) {
          // ... хэрэглэгчийн мэдээллийг Firestore-оос татах
          setUser(formattedUser);
        } else {
          setUser(null);
        }
        setLoading(false);
      });
      return () => unsubscribeAuth();
    }, []);
    ```
-   **`CityContext.tsx`**: Сонгогдсон хотын төлөв, боломжит хотуудын жагсаалтыг удирдах context. `useCity` hook-оор дамжуулан ашиглана.
-   **`LanguageContext.tsx`**: Аппын хэлний сонголт (`mn` эсвэл `cn`), орчуулгын функц `t()`-г удирдах context. `useLanguage` hook-оор дамжуулан ашиглана.
-   **`SearchContext.tsx`**: Хайлтын талбарын утгыг глобал төлөвт хадгалах context. `useSearch` hook-оор дамжуулан ашиглана.

### `src/hooks/` - Custom Hooks

Дахин ашиглагдах, тодорхой үүрэгтэй логикуудыг салгаж авсан хэсэг.

-   `use-toast.ts`: "Toast" (дэлгэцийн доод хэсэгт гардаг жижиг мэдэгдэл) харуулах hook.
-   `useTranslation.ts`: `LanguageContext`-ийг хялбар ашиглах зориулалттай hook. `t()` функц, `language`, `setLanguage`-ийг буцаана.

### `src/lib/` - Туслах функц ба Тохиргоо

Аппын үндсэн тохиргоо болон бусад туслах функцуудыг агуулна.

-   `firebase.ts`: Firebase-ийн бүх үйлчилгээг (Auth, Firestore, Storage, Messaging) эхлүүлж, экспортлодог гол файл.
-   `constants.ts`: Аппад ашиглагдах тогтмол өгөгдлүүд (үйлчилгээний ангилал, нисэх онгоцны буудлуудын жагсаалт гэх мэт).
-   `storageService.ts`: Firebase Storage-тай ажиллах функцуудыг агуулдаг (зураг байршуулах, файлын хэмжээ шалгах гэх мэт).
-   `utils.ts`: `cn` (Tailwind CSS-ийн class-уудыг нэгтгэх) гэх мэт жижиг туслах функцууд.

### `src/types/` - TypeScript Төрлүүд

-   `index.ts`: Аппын бүх custom TypeScript төрлүүдийг (`UserProfile`, `Order`, `Translator` гэх мэт) нэг дор тодорхойлсон файл. Энэ нь кодын уншигдах байдал, засварлахад хялбар байдлыг хангаж, төрлийн алдаанаас сэргийлдэг.

---

## Мобайл Хувилбар (Capacitor)

Энэхүү төсөл нь Capacitor ашиглан Native Android болон iOS апп болгон хөрвүүлэх боломжтой.

### Үндсэн тохиргоо

-   **`capacitor.config.ts`**: Capacitor-ийн үндсэн тохиргоог агуулдаг. Апп-ын ID (`appId`), нэр (`appName`), болон вэб файлууд байрлах хавтас (`webDir`) зэргийг энд тодорхойлно. `webDir` нь `'out'` гэж тохируулагдсан бөгөөд энэ нь Next.js-ийн статик экспорт хийсэн файлуудыг ашиглана гэсэн үг.
-   **`next.config.ts`**: Мобайл болон вэб хувилбарын build-ийг ялгаатай хийх зорилгоор нөхцөлт логик ашигласан. `CAPACITOR_BUILD=true` орчны хувьсагч тохируулагдсан үед `output: 'export'` болон `images: { unoptimized: true }` тохиргоог автоматаар идэвхжүүлдэг. Энэ нь Capacitor-т зориулсан статик хувилбар үүсгэхэд шаардлагатай.
-   **`package.json`**: Мобайл хувилбар үүсгэх ажлыг хөнгөвчлөх script-үүд нэмэгдсэн:
    -   `capacitor:sync`: Вэб хувилбарыг статикаар build хийж (`CAPACITOR_BUILD=true` хувьсагчтайгаар), үүссэн `out` хавтасны агуулгыг Android болон iOS-ийн native төслүүд рүү хуулна.
    -   `capacitor:copy`: Зөвхөн хуулах үйлдлийг хийнэ.
    -   `capacitor:open:android`: Android Studio-д төслийг нээнэ.
    -   `capacitor:open:ios`: Xcode-д төслийг нээнэ.

### Мобайл хувилбар үүсгэх заавар

1.  **Dependencies суулгах**: `npm install`
2.  **Native төсөл үүсгэх (анхны удаа)**:
    ```bash
    npx cap add android
    npx cap add ios
    ```
3.  **Sync хийх**: Вэб кодын өөрчлөлтийг native төсөл рүү хуулахын тулд дараах командыг ажиллуулна:
    ```bash
    npm run capacitor:sync
    ```
4.  **Native IDE-д нээх**:
    -   Android: `npm run capacitor:open:android`
    -   iOS: `npm run capacitor:open:ios`
5.  **Build хийж, ажиллуулах**: Android Studio эсвэл Xcode ашиглан аппликейшнээ build хийж, эмулятор эсвэл бодит төхөөрөмж дээр ажиллуулна.

### Firebase & Push Notification тохиргоо (Мобайл дээр)

Мобайл апп дээр Firebase Push Notification зөв ажиллахын тулд дараах нэмэлт тохиргоог хийх шаардлагатай.

#### Android:

1.  Firebase консол дээр Android аппаа нэмнэ (`applicationId` нь `capacitor.config.ts` доторх `appId`-тай ижил байх ёстой).
2.  **`google-services.json`** файлыг татаж аваад, төслийн `android/app/` хавтаст хуулна.
3.  **Notification Icon**: `android/app/src/main/res/drawable/` хавтас дотор `ic_stat_icon_default.png` нэртэйгээр мэдэгдлийн икон (жижиг, нэг өнгийн лого)-г байршуулна.

#### iOS:

1.  Firebase консол дээр iOS аппаа нэмнэ (`bundleId` нь `capacitor.config.ts` доторх `appId`-тай ижил байх ёстой).
2.  **`GoogleService-Info.plist`** файлыг татаж аваад, Xcode-оор дамжуулан `App/App` хавтаст нэмнэ.
3.  Xcode дотроос `Signing & Capabilities` хэсэгт `Push Notifications` болон `Background Modes` (Remote notifications сонголттойгоор) чадваруудыг нэмнэ.

Дэлгэрэнгүй зааврыг Capacitor-ийн Push Notification-ы баримт бичгээс харна уу.

---

## Firebase & Аюулгүй Байдал

### `firestore.rules`

Firestore өгөгдлийн сангийн аюулгүй байдлын дүрмүүд. Хэрэглэгчийн хандалтыг хязгаарлаж, зөвхөн зөвшөөрөгдсөн үйлдлүүдийг хийх боломжийг олгоно.

**Үндсэн зарчмууд:**
-   **`users`**: Хэрэглэгч зөвхөн өөрийнхөө баримт бичгийг уншиж, шинэчилж чадна.
-   **`ankets`, `orders`, `savedItems`, `notifications` (хэрэглэгчийн доорх)**: Хэрэглэгч зөвхөн өөрт хамааралтай мэдээллийг үүсгэж, уншиж, устгаж чадна.
-   **`entries`, `cities`, `banners`, `help_items`**: Эдгээр нийтийн мэдээллийг хэн ч уншиж чадах боловч зөвхөн админ/сервер талаас үүсгэж, засварлаж, устгана.

---

## Төслийн бусад файлууд

-   **`next.config.ts`**: Next.js-ийн үндсэн тохиргооны файл. Зургийн домайн, орчны хувьсагч, Capacitor-ын build-ийн тохиргоо зэргийг энд тохируулна.
-   **`tailwind.config.ts`**: Tailwind CSS-ийн тохиргоо (фонт, өргөтгөлүүд).
-   **`tsconfig.json`**: TypeScript-ийн тохиргоо.
-   **`package.json`**: Төслийн хамаарлууд (dependencies) болон script-үүдийг тодорхойлно.
-   **`README.md`**: Энэхүү баримт бичиг.

    
